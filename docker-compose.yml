data:
  build: ./volume
  volumes:
    - /web_app/volume/
    - /web_app/static/
elasticsearch:
  image: docker.elastic.co/elasticsearch/elasticsearch:5.4.2
  volumes:
    - ./elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml
  ports:
    - "9200:9200"
    - "9300:9300"
  environment:
    ES_JAVA_OPTS: "-Xmx256m -Xms256m"
postgresdb:
  image: postgres:9.4.5
  environment:
    POSTGRES_PASSWORD: mypassword
    POSTGRES_USER: echelon_user
web:
  build: .
  command: sh entry-point.sh
  volumes_from:
    - data
  ports:
    - "8001"
  links:
    - postgresdb:pgdb
    - elasticsearch:elastic
  environment:
    DJANGO_SETTINGS_MODULE: config.settings.prod
    PASSWORD: mypassword
    USER: echelon_user
reverse_proxy:
  build: ./nginx
  volumes_from:
    - data
  ports:
    - "81:81"
  links:
    - web:localhost
